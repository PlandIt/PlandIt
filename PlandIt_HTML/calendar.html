<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PlandIt – Calendar</title>
</head>
<body>
  <header>
    <h1>Calendar</h1>
    <div>
      <input id="search" placeholder="Search…" />
      <button onclick="go('index.html')">Dashboard</button>
      <button onclick="go('tasks.html')">See Tasks</button>
      <button onclick="go('about.html')">About</button>
    </div>
    <hr />
  </header>

  <nav>
    <button id="newEventBtn">New Event</button>
    <hr />
  </nav>

  <main>
    <ul id="list"></ul>
  </main>

  <script>
    function go(p){ location.href=p; }
    const get=(k,f)=>JSON.parse(localStorage.getItem(k)||JSON.stringify(f));
    const set=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
    let q='';

    function render(){
      const list = document.getElementById('list');
      const tasks = get('plandit_tasks', []);
      const events = get('plandit_events', []);
      list.textContent = '';

      const items = [
        ...events.map(e=>({type:'event', title:e.title, date:e.date, ref:e})),
        ...tasks.filter(t=>t.date).map(t=>({type:'task', title:t.title, date:t.date, ref:t}))
      ].filter(x => !q || (x.title||'').toLowerCase().includes(q) || (x.date||'').toLowerCase().includes(q))
       .sort((a,b)=> String(a.date).localeCompare(String(b.date)));

      if(items.length===0){ list.appendChild(document.createTextNode('Nothing scheduled.')); return; }

      items.forEach(x=>{
        const li=document.createElement('li');
        const label = document.createTextNode(`[${x.type==='event'?'Event':'Task'}] ${x.title} — ${x.date} `);
        li.appendChild(label);
        if(x.type==='event'){
          const edit=document.createElement('button'); edit.textContent='Edit';
          edit.onclick=()=>{ const t=prompt('Title', x.ref.title); if(!t) return; const d=prompt('YYYY-MM-DD', x.ref.date); if(!d) return; x.ref.title=t.trim(); x.ref.date=d.trim(); const ev=get('plandit_events',[]); set('plandit_events', ev); render(); };
          const del=document.createElement('button'); del.textContent='Delete';
          del.onclick=()=>{ const ev=get('plandit_events',[]); const i=ev.findIndex(e=>e.id===x.ref.id); ev.splice(i,1); set('plandit_events',ev); render(); };
          li.append(' ', edit, ' ', del);
        } else {
          const setDate=document.createElement('button'); setDate.textContent='Change Date';
          setDate.onclick=()=>{ const d=prompt('YYYY-MM-DD', x.ref.date); if(d===null) return; x.ref.date=(d||'').trim()||undefined; const t=get('plandit_tasks',[]); set('plandit_tasks',t); render(); };
          const rename=document.createElement('button'); rename.textContent='Rename';
          rename.onclick=()=>{ const n=prompt('Rename task', x.ref.title); if(!n) return; x.ref.title=n.trim(); const t=get('plandit_tasks',[]); set('plandit_tasks',t); render(); };
          const del=document.createElement('button'); del.textContent='Delete';
          del.onclick=()=>{ const t=get('plandit_tasks',[]); const i=t.findIndex(e=>e.id===x.ref.id); t.splice(i,1); set('plandit_tasks',t); render(); };
          li.append(' ', setDate, ' ', rename, ' ', del);
        }
        list.appendChild(li);
      });
    }

    document.getElementById('newEventBtn').onclick = ()=>{
      const title = prompt('Event title'); if(!title) return;
      const date = prompt('YYYY-MM-DD', new Date().toISOString().slice(0,10)); if(!date) return;
      const ev = get('plandit_events', []);
      ev.push({ id: Date.now(), title: title.trim(), date: date.trim() });
      set('plandit_events', ev);
      render();
      alert('Event saved');
    };
    document.getElementById('search').addEventListener('input', (e)=>{ q=e.target.value.trim().toLowerCase(); render(); });

    render();
  </script>
</body>
</html>
