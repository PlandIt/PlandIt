<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PlandIt – Tasks</title>
</head>
<body>
  <header>
    <h1>Tasks</h1>
    <div>
      <input id="search" placeholder="Search tasks…" />
      <button onclick="go('index.html')">Dashboard</button>
      <button onclick="go('calendar.html')">Calendar</button>
      <button onclick="go('about.html')">About</button>
    </div>
    <hr />
  </header>

  <nav>
    <button id="newTaskBtn">New Task</button>
    <button id="sortBtn">Sort (Undone first)</button>
    <hr />
  </nav>

  <main>
    <ul id="list"></ul>
  </main>

  <script>
    // utils
    function go(p){ location.href = p; }
    const get = (k,f)=>JSON.parse(localStorage.getItem(k)||JSON.stringify(f));
    const set = (k,v)=>localStorage.setItem(k,JSON.stringify(v));
    let q='';

    function render(){
      const list = document.getElementById('list');
      const tasks = get('plandit_tasks', []);
      list.textContent = '';
      const filtered = tasks.filter(t => !q || (t.title||'').toLowerCase().includes(q) || (t.date||'').toLowerCase().includes(q));
      if(filtered.length===0){ list.appendChild(document.createTextNode('No tasks')); return; }
      filtered.forEach(t=>{
        const li = document.createElement('li');
        const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!t.done;
        cb.addEventListener('change', ()=>{ t.done = !t.done; set('plandit_tasks', tasks); render(); });
        const title = document.createTextNode(' '+t.title + (t.date?(' — '+t.date):' ')+' ');
        const rename = document.createElement('button'); rename.textContent='Rename';
        rename.onclick = ()=>{ const n=prompt('Rename task', t.title); if(!n) return; t.title=n.trim(); set('plandit_tasks',tasks); render(); };
        const setDate = document.createElement('button'); setDate.textContent = t.date?'Change Date':'Set Date';
        setDate.onclick = ()=>{ const d=prompt('Set task date (YYYY-MM-DD)', t.date||new Date().toISOString().slice(0,10)); if(d===null) return; t.date=(d||'').trim()||undefined; set('plandit_tasks',tasks); render(); };
        const del = document.createElement('button'); del.textContent='Delete';
        del.onclick = ()=>{ const i=tasks.findIndex(x=>x===t); tasks.splice(i,1); set('plandit_tasks',tasks); render(); };
        li.append(cb, title, rename, document.createTextNode(' '), setDate, document.createTextNode(' '), del);
        list.appendChild(li);
      });
    }

    document.getElementById('newTaskBtn').onclick = ()=>{
      const title = prompt('Task title'); if(!title) return;
      const date = prompt('Due date (YYYY-MM-DD, optional)');
      const tasks = get('plandit_tasks', []);
      tasks.unshift({ id: Date.now(), title: title.trim(), done:false, date:(date||'').trim()||undefined });
      set('plandit_tasks', tasks);
      render();
      alert('Task saved');
    };
    document.getElementById('sortBtn').onclick = ()=>{
      const tasks = get('plandit_tasks', []);
      tasks.sort((a,b)=> Number(a.done) - Number(b.done));
      set('plandit_tasks', tasks);
      render();
    };
    document.getElementById('search').addEventListener('input',(e)=>{ q=e.target.value.trim().toLowerCase(); render(); });

    render();
  </script>
</body>
</html>
